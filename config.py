"""
配置文件 - 统一管理所有配置项
"""
import os

# ============================================================================
# 语音识别后端配置
# ============================================================================

# 首选的语音识别后端
PREFERRED_ASR_BACKEND = 'qwen'  # 可选: 'dashscope', 'qwen', 'qwen_international'

# 有效的后端列表
VALID_ASR_BACKENDS = {'dashscope', 'qwen', 'qwen_international'}

# ============================================================================
# 语音识别模型配置
# ============================================================================

# DashScope 后端使用的模型
DASHSCOPE_ASR_MODEL = 'fun-asr-realtime'

# Qwen 后端使用的模型
QWEN_ASR_MODEL = 'qwen3-asr-flash-realtime'

# Qwen WebSocket URL
QWEN_ASR_URL = 'wss://dashscope.aliyuncs.com/api-ws/v1/realtime'
QWEN_ASR_URL_INTERNATIONAL = 'wss://dashscope-intl.aliyuncs.com/api-ws/v1/realtime'

# ============================================================================
# 音频参数配置
# ============================================================================

SAMPLE_RATE = 16000  # 采样率 (Hz)
CHANNELS = 1  # 单声道
DTYPE = 'int16'  # 数据类型
BITS = 16  # 每个采样的位数
FORMAT_PCM = 'pcm'  # 音频数据格式
BLOCK_SIZE = 1600  # 每个缓冲区的帧数

# ============================================================================
# 翻译语言配置
# ============================================================================

SOURCE_LANGUAGE = 'auto'  # 翻译源语言（'auto' 为自动检测，或指定如 'en', 'ja' 等）
TARGET_LANGUAGE = 'ja'  # 翻译目标语言（'zh-CN'=简体中文, 'en'=英文, 'ja'=日文 等）
FALLBACK_LANGUAGE = 'en'  # 备用翻译语言（当源语言和目标语言相同时使用）
                           # 设置为 None（非字符串）则禁用备用语言功能

# ============================================================================
# 翻译 API 配置
# ============================================================================

# 翻译 API 类型
# 可选: 'google_web', 'google_dictionary', 'deepl', 'openrouter', 'openrouter_streaming'
TRANSLATION_API_TYPE = 'deepl'

# OpenRouter 翻译模型配置
OPENROUTER_TRANSLATION_MODEL = 'google/gemini-2.5-flash-lite'
OPENROUTER_TRANSLATION_TEMPERATURE = 0.2
OPENROUTER_TRANSLATION_TIMEOUT = 30
OPENROUTER_TRANSLATION_MAX_RETRIES = 3

# ============================================================================
# 翻译功能配置
# ============================================================================

# 是否启用翻译功能
ENABLE_TRANSLATION = True  # True: 识别后翻译文本
                           # False: 直接发送识别结果，不翻译

# 是否启用流式翻译（翻译部分结果）
# 仅当 TRANSLATION_API_TYPE 为 'openrouter_streaming' 时有效
TRANSLATE_PARTIAL_RESULTS = False

# 是否启用反向翻译功能
ENABLE_REVERSE_TRANSLATION = True  # True: 翻译后再反向翻译回源语言
                                    # False: 不进行反向翻译

# 翻译上下文前缀
CONTEXT_PREFIX = "This is an audio transcription of a conversation within the online multiplayer social game VRChat:"

# 翻译上下文大小（保留多少条历史记录）
TRANSLATION_CONTEXT_SIZE = 6

# 是否启用上下文感知翻译
TRANSLATION_CONTEXT_AWARE = True

# ============================================================================
# 麦克风控制配置
# ============================================================================

# 是否考虑游戏内麦克风的开关情况
ENABLE_MIC_CONTROL = True  # True: 根据 VRChat 麦克风状态控制识别的启动/停止
                           # False: 程序启动时立即开始识别,忽略麦克风开关消息

# 收到静音消息后延迟停止识别的秒数
MUTE_DELAY_SECONDS = 0.2  # 设置为 0 则立即停止

# ============================================================================
# 热词配置
# ============================================================================

# 是否启用热词功能
ENABLE_HOT_WORDS = True

# 热词文件路径
HOT_WORDS_DIR = 'hot_words'
HOT_WORDS_PRIVATE_DIR = 'hot_words_private'

# ============================================================================
# VAD 配置（仅 Qwen 后端）
# ============================================================================

# 是否启用服务器端VAD（语音活动检测）
ENABLE_VAD = True  # True: 启用VAD，服务器自动检测语音结束并断句
                   # False: 禁用VAD，需要手动调用commit()来触发断句
                   # 注意：VAD和手动commit不能同时使用
                   # - 启用VAD时，pause()会发送静音音频触发断句，而不是调用commit()
                   # - 禁用VAD时，pause()会调用commit()手动断句

# VAD阈值（0.0-1.0），值越小越敏感
VAD_THRESHOLD = 0.2

# VAD静音持续时间（毫秒），检测到此时长的静音后触发断句
VAD_SILENCE_DURATION_MS = 1200

# ============================================================================
# WebSocket 保活配置（仅 Qwen 后端）
# ============================================================================

# WebSocket心跳间隔（秒），防止长时间闲置导致连接超时
KEEPALIVE_INTERVAL = 30  # 设置为0则禁用心跳功能
                         # 建议值：30-60秒，根据服务器超时设置调整

# ============================================================================
# 显示配置
# ============================================================================

# 是否显示识别中的部分结果（ongoing）
SHOW_PARTIAL_RESULTS = False  # True: 显示部分识别结果到聊天框（可能覆盖掉之前的翻译结果）
                               # False: 只显示完整识别结果

# ============================================================================
# 语言检测器配置
# ============================================================================

# 语言检测器类型
# 可选: 'cjke' (中日韩英), 'enzh' (中英), 'fasttext' (通用)
LANGUAGE_DETECTOR_TYPE = 'cjke'

# ============================================================================
# 日志配置
# ============================================================================

# 日志级别: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL = 'ERROR'

# ============================================================================
# OSC 配置
# ============================================================================

# OSC 服务器配置
OSC_SERVER_IP = '127.0.0.1'
OSC_SERVER_PORT = 9000

# OSC 客户端配置
OSC_CLIENT_IP = '127.0.0.1'
OSC_CLIENT_PORT = 9001

# ============================================================================
# 线程池配置
# ============================================================================

# 线程池最大工作线程数
MAX_WORKERS = 8

# ============================================================================
# 反向翻译配置
# ============================================================================

# 是否启用反向翻译验证
ENABLE_BACKWARDS_TRANSLATION = True

# 反向翻译目标语言
BACKWARDS_TRANSLATION_TARGET = 'en'

# ============================================================================
# 模型名称常量（用于热词表创建等）
# ============================================================================

# DashScope 热词表目标模型
DASHSCOPE_HOTWORD_MODEL = 'fun-asr-realtime'
